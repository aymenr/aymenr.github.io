<!doctype html>
<html lang="en">
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

	<link rel="stylesheet" href="./main.css">
	<link rel="shortcut icon" href="favicon.ico">
	<title>Aymen Rizwan</title>
</head>
<body>

	<div class="container .navbar "> 
		<a href="./index.html"> projects </a>
		<a href> photography & film </a>
		<a href> about </a>
	</div>

	<hr>

	<div class="container main ">

		<h2> Patari Music </h2>

		<p> Big Query is a data warehouse for analytics, no infrastructure to manage

::Data warehouses are central repositories of integrated data and are used for analytics.::

::ETL (extract, transform load) process in database usage::

 Google BigQuery meets the challenges of real-time analytics by leveraging Googleâ€™s serverless infrastructure that uses automatic scaling and high-performance streaming ingestion to load data. It parallelizes execution and automatically performs performance optimizations 

* High speed streaming insertion API lets you do real-time analytics
* Replicated  + encrypted across multiple data centers (availability)


### Problem 
* Slow aggregation of data
* No flexibility for queries in terms of date ranges.

A cronjob would run everyday to aggregate the data first for songs, artists, and albums and then  for different time periods including day, months and quarters

*A weekly aggregation for playbacks would mean:* 
Say we have  *s* songs in the database  
You iterate over all *d* data points for a day and for each data point you do a query through *s* songs to increment the songs counter.  The running time would be on average *O(songs * data-points)* and for a week this would be 7 times this and for a month, 30 times of this and so on. 

*Actual pipeline*
* Events dumped into a json file on the server
* Daily job that aggregates data by song for the day and inserts them into mongo
This means *O (songs * data-points)* for daily song aggregations
* This data is aggregated for albums, artists and labels
*O(albums * songs)* etc
* This data is aggregated for weeks, months and all-time/
For a week this means *O( 7 songs * songs)*


* This would take hours to process on our own server which would mean we never had real time data (user recommendations, history etc)
* Had to maintain our own server and frequent crashes bugs etc meant that we had to constantly recompute this data
* Since we were only storing aggregations over days, weeks, months and quarters there was a limit to our query ability

*If we had to do a daily aggregation for users*
* We could store an array with key:value pairs for song and plays for each user
* So for an aggregation it would take (*users* * *songs*)
 
### Solution
* Logs for the day are converted to a big-query agreeable format and uploaded to big query (via its command line tool)
* Separate tables are made for logs which are regularly queried (like playbacks), this is because Big Query charges for total number of rows processed per query. Most common events are in separate tables so lesser data is processed in their query
* Write SQL Query to get any date range/aggregation
* These are also turned into API endpoints for our own web app for artist accounts that shows their plays
* Created into dashboards in Google DataStudio

/BigQuery is free for up to 1TB of data analyzed each month and 10GB of data stored./</p>

	</div>

	<div class="container footer">
		<div class="row">
			<div class="col-sm-8">
				<img src ="logo.png" class="logo"> 
			</div>
			<div class="col-sm-4">
				aymen@stanford.edu
			</div>
		</div>
	</div>
	<!-- Optional JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>